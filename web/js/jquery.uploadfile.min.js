!function(e){void 0==e.fn.ajaxForm&&(document.location.href.indexOf("dd_admin")>0?e.getScript("../js/jquery.form.js"):e.getScript("js/jquery.form.js"));var r={};r.fileapi=void 0!==e("<input type='file'/>").get(0).files,r.formdata=void 0!==window.FormData,e.fn.uploadFile=function(t){function a(){v.afterUploadAll&&!b&&(b=!0,function e(){0!=w.sCounter&&w.sCounter+w.fCounter==w.tCounter?(v.afterUploadAll(w),b=!1):window.setTimeout(e,100)}())}function o(r,t,a){a.on("dragenter",function(r){r.stopPropagation(),r.preventDefault(),e(this).addClass(t.dragDropHoverClass)}),a.on("dragover",function(r){r.stopPropagation(),r.preventDefault();var a=e(this);a.hasClass(t.dragDropContainerClass)&&!a.hasClass(t.dragDropHoverClass)&&a.addClass(t.dragDropHoverClass)}),a.on("drop",function(a){a.preventDefault(),e(this).removeClass(t.dragDropHoverClass),r.errorLog.html("");var o=a.originalEvent.dataTransfer.files;return!t.multiple&&o.length>1?void(t.showError&&e("<div class='"+t.errorClass+"'>"+t.multiDragErrorStr+"</div>").appendTo(r.errorLog)):void(0!=t.onSelect(o)&&l(t,r,o))}),a.on("dragleave",function(r){e(this).removeClass(t.dragDropHoverClass)}),e(document).on("dragenter",function(e){e.stopPropagation(),e.preventDefault()}),e(document).on("dragover",function(r){r.stopPropagation(),r.preventDefault();var a=e(this);a.hasClass(t.dragDropContainerClass)||a.removeClass(t.dragDropHoverClass)}),e(document).on("drop",function(r){r.stopPropagation(),r.preventDefault(),e(this).removeClass(t.dragDropHoverClass)})}function s(e){var r="",t=e/1024;if(parseInt(t)>1024){var a=t/1024;r=a.toFixed(2)+" MB"}else r=t.toFixed(2)+" KB";return r}function i(r){var t=[];t="string"==jQuery.type(r)?r.split("&"):e.param(r).split("&");var a,o,s=t.length,i=[];for(a=0;s>a;a++)t[a]=t[a].replace(/\+/g," "),o=t[a].split("="),i.push([decodeURIComponent(o[0]),decodeURIComponent(o[1])]);return i}function l(r,t,a){for(var o=0;o<a.length;o++)if(n(t,r,a[o].name))if(r.allowDuplicates||!d(t,a[o].name))if(-1!=r.maxFileSize&&a[o].size>r.maxFileSize)r.showError&&e("<div class='"+r.errorClass+"'><b>"+a[o].name+"</b> "+r.sizeErrorStr+s(r.maxFileSize)+"</div>").appendTo(t.errorLog);else if(-1!=r.maxFileCount&&t.selectedFiles>=r.maxFileCount)r.showError&&e("<div class='"+r.errorClass+"'><b>"+a[o].name+"</b> "+r.maxFileCountErrorStr+r.maxFileCount+"</div>").appendTo(t.errorLog);else{t.selectedFiles++,t.existingFileNames.push(a[o].name);var l=r,u=new FormData,p=r.fileName.replace("[]","");u.append(p,a[o]);var c=r.formData;if(c)for(var h=i(c),v=0;v<h.length;v++)h[v]&&u.append(h[v][0],h[v][1]);l.fileData=u;var g=new f(t,r),w="";w=r.showFileCounter?t.fileCounter+r.fileCounterStyle+a[o].name:a[o].name,g.filename.html(w);var C=e("<form style='display:block; position:absolute;left: 150px;' class='"+t.formGroup+"' method='"+r.method+"' action='"+r.url+"' enctype='"+r.enctype+"'></form>");C.appendTo("body");var b=[];b.push(a[o].name),m(C,l,g,b,t,a[o]),t.fileCounter++}else r.showError&&e("<div class='"+r.errorClass+"'><b>"+a[o].name+"</b> "+r.duplicateErrorStr+"</div>").appendTo(t.errorLog);else r.showError&&e("<div class='"+r.errorClass+"'><b>"+a[o].name+"</b> "+r.extErrorStr+r.allowedTypes+"</div>").appendTo(t.errorLog)}function n(e,r,t){var a=r.allowedTypes.toLowerCase().split(","),o=t.split(".").pop().toLowerCase();return"*"!=r.allowedTypes&&jQuery.inArray(o,a)<0?!1:!0}function d(e,r){var t=!1;if(e.existingFileNames.length)for(var a=0;a<e.existingFileNames.length;a++)(e.existingFileNames[a]==r||v.duplicateStrict&&e.existingFileNames[a].toLowerCase()==r.toLowerCase())&&(t=!0);return t}function u(e,r){if(e.existingFileNames.length)for(var t=0;t<r.length;t++){var a=e.existingFileNames.indexOf(r[t]);-1!=a&&e.existingFileNames.splice(a,1)}}function p(e,r){if(e){r.show();var t=new FileReader;t.onload=function(e){r.attr("src",e.target.result)},t.readAsDataURL(e)}}function c(r,t){if(r.showFileCounter){var a=e(".ajax-file-upload-filename").length;t.fileCounter=a+1,e(".ajax-file-upload-filename").each(function(t,o){var s=e(this).html().split(r.fileCounterStyle),i=(parseInt(s[0])-1,a+r.fileCounterStyle+s[1]);e(this).html(i),a--})}}function h(t,a,o,s){var i="ajax-upload-id-"+(new Date).getTime(),d=e("<form method='"+o.method+"' action='"+o.url+"' enctype='"+o.enctype+"'></form>"),u="<input type='file' id='"+i+"' name='"+o.fileName+"' accept='"+o.acceptFiles+"'/>";o.multiple&&(o.fileName.indexOf("[]")!=o.fileName.length-2&&(o.fileName+="[]"),u="<input type='file' id='"+i+"' name='"+o.fileName+"' accept='"+o.acceptFiles+"' multiple/>");var p=e(u).appendTo(d);p.change(function(){t.errorLog.html("");var i=(o.allowedTypes.toLowerCase().split(","),[]);if(this.files){for(w=0;w<this.files.length;w++)i.push(this.files[w].name);if(0==o.onSelect(this.files))return}else{var u=e(this).val(),p=[];if(i.push(u),!n(t,o,u))return void(o.showError&&e("<div class='"+o.errorClass+"'><b>"+u+"</b> "+o.extErrorStr+o.allowedTypes+"</div>").appendTo(t.errorLog));if(p.push({name:u,size:"NA"}),0==o.onSelect(p))return}if(c(o,t),s.unbind("click"),d.hide(),h(t,a,o,s),d.addClass(a),r.fileapi&&r.formdata){d.removeClass(a);var v=this.files;l(o,t,v)}else{for(var g="",w=0;w<i.length;w++)g+=o.showFileCounter?t.fileCounter+o.fileCounterStyle+i[w]+"<br>":i[w]+"<br>",t.fileCounter++;if(-1!=o.maxFileCount&&t.selectedFiles+i.length>o.maxFileCount)return void(o.showError&&e("<div class='"+o.errorClass+"'><b>"+g+"</b> "+o.maxFileCountErrorStr+o.maxFileCount+"</div>").appendTo(t.errorLog));t.selectedFiles+=i.length;var C=new f(t,o);C.filename.html(g),m(d,o,C,i,t,null)}}),o.nestedForms?(d.css({margin:0,padding:0}),s.css({position:"relative",overflow:"hidden",cursor:"default"}),p.css({position:"absolute",cursor:"pointer",top:"0px",width:"100%",height:"100%",left:"0px","z-index":"100",opacity:"0.0",filter:"alpha(opacity=0)","-ms-filter":"alpha(opacity=0)","-khtml-opacity":"0.0","-moz-opacity":"0.0"}),d.appendTo(s)):(d.appendTo(e("body")),d.css({margin:0,padding:0,display:"block",position:"absolute",left:"-250px"}),-1!=navigator.appVersion.indexOf("MSIE ")?s.attr("for",i):s.click(function(){p.click()}))}function f(r,t){return this.statusbar=e("<div class='ajax-file-upload-statusbar'></div>").width(t.statusBarWidth),this.preview=e("<img class='ajax-file-upload-preview' />").width(t.previewWidth).height(t.previewHeight).appendTo(this.statusbar).hide(),this.filename=e("<div class='ajax-file-upload-filename'></div>").appendTo(this.statusbar),this.progressDiv=e("<div class='ajax-file-upload-progress'>").appendTo(this.statusbar).hide(),this.progressbar=e("<div class='ajax-file-upload-bar "+r.formGroup+"'></div>").appendTo(this.progressDiv),this.abort=e("<div class='ajax-file-upload-red "+t.abortButtonClass+" "+r.formGroup+"'>"+t.abortStr+"</div>").appendTo(this.statusbar).hide(),this.cancel=e("<div class='ajax-file-upload-red "+t.cancelButtonClass+" "+r.formGroup+"'>"+t.cancelStr+"</div>").appendTo(this.statusbar).hide(),this.done=e("<div class='ajax-file-upload-green'>"+t.doneStr+"</div>").appendTo(this.statusbar).hide(),this.download=e("<div class='ajax-file-upload-green'>"+t.downloadStr+"</div>").appendTo(this.statusbar).hide(),this.del=e("<div class='ajax-file-upload-red'>"+t.deletelStr+"</div>").appendTo(this.statusbar).hide(),t.showQueueDiv?e("#"+t.showQueueDiv).append(this.statusbar):r.errorLog.after(this.statusbar),this}function m(t,o,s,l,n,d){var h={cache:!1,contentType:!1,processData:!1,forceSync:!1,type:o.method,data:o.formData,formData:o.fileData,dataType:o.returnType,beforeSubmit:function(e,r,d){if(0!=o.onSubmit.call(this,l)){var p=o.dynamicFormData();if(p){var h=i(p);if(h)for(var f=0;f<h.length;f++)h[f]&&(void 0!=o.fileData?d.formData.append(h[f][0],h[f][1]):d.data[h[f][0]]=h[f][1])}return n.tCounter+=l.length,a(),!0}return s.statusbar.append("<div class='"+o.errorClass+"'>"+o.uploadErrorStr+"</div>"),s.cancel.show(),t.remove(),s.cancel.click(function(){u(n,l),s.statusbar.remove(),o.onCancel.call(n,l,s),n.selectedFiles-=l.length,c(o,n)}),!1},beforeSend:function(e,t){s.progressDiv.show(),s.cancel.hide(),s.done.hide(),o.showAbort&&(s.abort.show(),s.abort.click(function(){u(n,l),e.abort(),n.selectedFiles-=l.length})),r.formdata?s.progressbar.width("1%"):s.progressbar.width("5%")},uploadProgress:function(e,r,t,a){a>98&&(a=98);var i=a+"%";a>1&&s.progressbar.width(i),o.showProgress&&(s.progressbar.html(i),s.progressbar.css("text-align","center"))},success:function(r,a,i){if("json"==o.returnType&&"object"==e.type(r)&&r.hasOwnProperty(o.customErrorKeyStr)){s.abort.hide();var d=r[o.customErrorKeyStr];return o.onError.call(this,l,200,d,s),o.showStatusAfterError?(s.progressDiv.hide(),s.statusbar.append("<span class='"+o.errorClass+"'>ERROR: "+d+"</span>")):(s.statusbar.hide(),s.statusbar.remove()),n.selectedFiles-=l.length,t.remove(),void(n.fCounter+=l.length)}n.responses.push(r),s.progressbar.width("100%"),o.showProgress&&(s.progressbar.html("100%"),s.progressbar.css("text-align","center")),s.abort.hide(),o.onSuccess.call(this,l,r,i,s),o.showStatusAfterSuccess?(o.showDone?(s.done.show(),s.done.click(function(){s.statusbar.hide("slow"),s.statusbar.remove()})):s.done.hide(),o.showDelete?(s.del.show(),s.del.click(function(){s.statusbar.hide().remove(),o.deleteCallback&&o.deleteCallback.call(this,r,s),n.selectedFiles-=l.length,c(o,n)})):s.del.hide()):(s.statusbar.hide("slow"),s.statusbar.remove()),o.showDownload&&(s.download.show(),s.download.click(function(){o.downloadCallback&&o.downloadCallback(r)})),t.remove(),n.sCounter+=l.length},error:function(e,r,a){s.abort.hide(),"abort"==e.statusText?(s.statusbar.hide("slow").remove(),c(o,n)):(o.onError.call(this,l,r,a,s),o.showStatusAfterError?(s.progressDiv.hide(),s.statusbar.append("<span class='"+o.errorClass+"'>ERROR: "+a+"</span>")):(s.statusbar.hide(),s.statusbar.remove()),n.selectedFiles-=l.length),t.remove(),n.fCounter+=l.length}};o.showPreview&&null!=d&&"image"==d.type.toLowerCase().split("/").shift()&&p(d,s.preview),o.autoSubmit?t.ajaxSubmit(h):(o.showCancel&&(s.cancel.show(),s.cancel.click(function(){u(n,l),t.remove(),s.statusbar.remove(),o.onCancel.call(n,l,s),n.selectedFiles-=l.length,c(o,n)})),t.ajaxForm(h))}var v=e.extend({url:"",method:"POST",enctype:"multipart/form-data",returnType:null,allowDuplicates:!0,duplicateStrict:!1,allowedTypes:"*",acceptFiles:"*",fileName:"file",formData:{},dynamicFormData:function(){return{}},maxFileSize:-1,maxFileCount:-1,multiple:!0,dragDrop:!0,autoSubmit:!0,showCancel:!0,showAbort:!0,showDone:!0,showDelete:!1,showError:!0,showStatusAfterSuccess:!0,showStatusAfterError:!0,showFileCounter:!0,fileCounterStyle:"). ",showProgress:!1,nestedForms:!0,showDownload:!1,onLoad:function(e){},onSelect:function(e){return!0},onSubmit:function(e,r){},onSuccess:function(e,r,t,a){},onError:function(e,r,t,a){},onCancel:function(e,r){},downloadCallback:!1,deleteCallback:!1,afterUploadAll:!1,abortButtonClass:"ajax-file-upload-abort",cancelButtonClass:"ajax-file-upload-cancel",dragDropContainerClass:"ajax-upload-dragdrop",dragDropHoverClass:"state-hover",errorClass:"ajax-file-upload-error",uploadButtonClass:"ajax-file-upload",dragDropStr:"<span><b>Drag &amp; Drop Files</b></span>",uploadStr:"Upload",abortStr:"Abort",cancelStr:"Cancel",deletelStr:"Delete",doneStr:"Done",multiDragErrorStr:"Multiple File Drag &amp; Drop is not allowed.",extErrorStr:"is not allowed. Allowed extensions: ",duplicateErrorStr:"is not allowed. File already exists.",sizeErrorStr:"is not allowed. Allowed Max size: ",uploadErrorStr:"Upload is not allowed",maxFileCountErrorStr:" is not allowed. Maximum allowed files are:",downloadStr:"Download",customErrorKeyStr:"jquery-upload-file-error",showQueueDiv:!1,statusBarWidth:500,dragdropWidth:500,showPreview:!1,previewHeight:"auto",previewWidth:"100%",uploadFolder:"uploads/"},t);this.fileCounter=1,this.selectedFiles=0,this.fCounter=0,this.sCounter=0,this.tCounter=0;var g="ajax-file-upload-"+(new Date).getTime();this.formGroup=g,this.hide(),this.errorLog=e("<div></div>"),this.after(this.errorLog),this.responses=[],this.existingFileNames=[],r.formdata||(v.dragDrop=!1),r.formdata||(v.multiple=!1);var w=this,C=e("<div>"+e(this).html()+"</div>");e(C).addClass(v.uploadButtonClass),function x(){if(e.fn.ajaxForm){if(v.dragDrop){var r=e('<div class="'+v.dragDropContainerClass+'" style="vertical-align:top;"></div>').width(v.dragdropWidth);e(w).before(r),e(r).append(C),e(r).append(e(v.dragDropStr)),o(w,v,r)}else e(w).before(C);v.onLoad.call(this,w),h(w,g,v,C)}else window.setTimeout(x,10)}(),this.startUpload=function(){e("."+this.formGroup).each(function(r,t){e(this).is("form")&&e(this).submit()})},this.getFileCount=function(){return w.selectedFiles},this.stopUpload=function(){e("."+v.abortButtonClass).each(function(r,t){e(this).hasClass(w.formGroup)&&e(this).click()})},this.cancelAll=function(){e("."+v.cancelButtonClass).each(function(r,t){e(this).hasClass(w.formGroup)&&e(this).click()})},this.update=function(r){v=e.extend(v,r)},this.createProgress=function(e){var r=new f(this,v);r.progressDiv.show(),r.progressbar.width("100%");var t="";t=v.showFileCounter?w.fileCounter+v.fileCounterStyle+e:e,r.filename.html(t),w.fileCounter++,w.selectedFiles++,v.showPreview&&(r.preview.attr("src",v.uploadFolder+e),r.preview.show()),v.showDownload&&(r.download.show(),r.download.click(function(){v.downloadCallback&&v.downloadCallback.call(w,[e])})),r.del.show(),r.del.click(function(){r.statusbar.hide().remove();var t=[e];v.deleteCallback&&v.deleteCallback.call(this,t,r),w.selectedFiles-=1,c(v,w)})},this.getResponses=function(){return this.responses};var b=!1;return this}}(jQuery);